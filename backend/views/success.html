<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>reCaptcha Successfull</title>
  </head>
  <body>
    <div class="msg">
      <h1>reCaptcha Solved Successfully and form submitted!</h1>
      <div id="usersTable"></div>
    </div>

    <!-- script to display db data in table format -->
    <script>
      window.onload = function () {
        fetch("/get-users")
          .then((response) => response.json())
          .then((data) => {
            const table = createTable(data);
            document.getElementById("usersTable").appendChild(table);
          })
          .catch((error) => console.log("Error", error));
      };

      //function handling table creation
      function createTable(users) {
        const table = document.createElement("table");

        //add table headers
        const headerRow = table.insertRow();
        ["First Name", "Last Name", "Email"].forEach((headerText) => {
          let header = document.createElement("th");
          header.textContent = headerText;
          headerRow.appendChild(header);
        });

        //Add row
        users.forEach((user) => {
          const row = table.insertRow();
          ["fname", "lname", "email"].forEach((column) => {
            const cell = row.insertCell();
            cell.textContent = user[column];
          });
        });
        return table;
      }
    </script>
  </body>
</html>
